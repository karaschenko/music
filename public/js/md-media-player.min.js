angular.module("md.media.player",["md.media.templates"]),angular.module("md.media.player").factory("$album",["$http","$q",function(a,b){"use strict";function c(a,b){this.artist=a.artistName,this.artworkUrl=a.artworkUrl60.replace("60x60-50","600x600"),this.release=a.releaseDate.split("-").shift(),this.title=a.collectionName,this.trackCount=b.length,this.tracks=[],this._current=0,b.forEach(function(a){this.tracks.push({duration:a.trackTimeMillis/1e3,number:a.trackNumber,title:a.trackName})},this)}var d=[];return c.prototype.currentTrack=function(){return this.tracks[this._current]},c.prototype.hasNextTrack=function(){return this._current<this.trackCount-1},c.prototype.hasPreviousTrack=function(){return this._current>0},c.prototype.isShuffled=function(){var a=0;return this.tracks.some(function(b){return b.number!==++a})},c.prototype.nextTrack=function(){return this.hasNextTrack()?this.tracks[++this._current]:null},c.prototype.previousTrack=function(){return this.hasPreviousTrack()?this.tracks[--this._current]:null},c.prototype.selectTrack=function(a){this._current=a},c.prototype.shuffle=function(){for(var a,b,c=this.tracks.length,d=this.tracks[this._current];c;)a=Math.floor(Math.random()*c--),b=this.tracks[c],this.tracks[c]=this.tracks[a],this.tracks[a]=b;this._current=this.tracks.indexOf(d)},c.prototype.unShuffle=function(){this._current=this.tracks[this._current].number-1,this.tracks.sort(function(a,b){return a.number-b.number})},function(e){var f=b.defer();if(d.hasOwnProperty(e))f.resolve(d[e]);else{var g=JSON.parse(localStorage.getItem(e));g?(d[e]=new c(g.results.shift(),g.results),f.resolve(d[e])):a.jsonp("https://itunes.apple.com/lookup",{params:{callback:"JSON_CALLBACK",id:e,country:"us",entity:"song"}}).success(function(a){localStorage.setItem(e,JSON.stringify(a)),d[e]=new c(a.results.shift(),a.results),f.resolve(d[e])})}return f.promise}}]),angular.module("md.media.player").factory("$audio",function(){"use strict";function a(){return f()&&o.buffered.length?Math.floor(o.buffered.end(o.buffered.length-1)):0}function b(){return f()?Math.floor(o.currentTime):0}function c(){return f()&&!isNaN(o.duration)?Math.floor(o.duration):0}function d(){return f()?!o.paused:!1}function e(){return o?o.hasAttribute("loop"):!1}function f(){return o?!0:!1}function g(a,b){f()&&(angular.isArray(a)?a.forEach(function(a){o.removeEventListener(a,b)}):o.removeEventListener(a,b))}function h(a,b){f()&&(angular.isArray(a)?a.forEach(function(a){o.addEventListener(a,b)}):o.addEventListener(a,b))}function i(){f()&&o.play()}function j(){f()&&o.pause()}function k(){o&&o.removeAttribute("loop")}function l(){o&&o.setAttribute("loop","")}function m(a){o?(o.src=a,o.load()):o=new Audio(a)}function n(a){o&&(o.currentTime=a)}var o;return{buffered:a,currentTime:b,duration:c,isPlaying:d,isRepeatEnabled:e,isSet:f,off:g,on:h,play:i,pause:j,repeatOff:k,repeatOn:l,set:m,setCurrentTime:n}}),angular.module("md.media.player").controller("mdMediaPlayerController",["$attrs","$audio","$element","$scope",function(a,b,c,d){"use strict";d.audio=b,d.getBuffer=function(){return b.buffered()/b.duration()*100},d.getValue=function(){return b.currentTime()/b.duration()*100},d.selectTrack=function(c,e){d.album.selectTrack(e),b.set(a.src.replace("${track-title}",c.title)),b.play()},d.selectNext=function(){var c=b.isPlaying();b.set(a.src.replace("${track-title}",d.album.nextTrack().title)),c&&b.play()},d.selectPrevious=function(){var c=b.isPlaying();b.set(a.src.replace("${track-title}",d.album.previousTrack().title)),c&&b.play()},d.toggleRepeat=function(){b.isRepeatEnabled()?b.repeatOff():b.repeatOn()},d.toggleShuffle=function(){d.album.isShuffled()?d.album.unShuffle():d.album.shuffle()}}]).directive("mdMediaPlayer",["$album","$audio",function(a,b){"use strict";function c(c,d,e){function f(){c.album.hasNextTrack()&&(b.set(e.src.replace("${track-title}",c.album.nextTrack().title)),b.play())}function g(){c.$evalAsync()}function h(){b.off("ended",f),b.off(l,g)}var i=d.find("md-progress-linear"),j=d.find("md-content"),k=j.prop("previousElementSibling"),l=["loadstart","progress","timeupdate"];a(e.collectionId).then(function(a){c.album=a,e.$set("src",e.src.replace("${album-artits}",a.artist)),e.$set("src",e.src.replace("${album-title}",a.title)),b.isSet()||b.set(e.src.replace("${track-title}",a.currentTrack().title)),b.on("ended",f),b.on(l,g),c.$on("$destroy",h),i.on(i.hasOwnProperty("ontouchstart")?"touchstart":"mousedown",function(a){b.setCurrentTime(a.layerX*(b.duration()/i.prop("clientWidth")))})}),j.on("scroll",function(){j.prop("scrollTop")<=0?k.classList.remove("elevate"):k.classList.add("elevate")})}return{templateUrl:"templates.media-player.html",controller:"mdMediaPlayerController",link:c}}]).directive("mdTrack",["$mdInkRipple",function(a){"use strict";return{link:function(b,c){a.attach(b,c)}}}]).filter("zeroPad",function(){"use strict";return function(a){return 10>a?"0"+a:a}}).filter("playBack",["$filter",function(a){"use strict";return function(b){var c=Math.floor(b/60),d=a("zeroPad")(Math.floor(b%60));return c+":"+d}}]),angular.module("md.media.templates",["templates.list.html","templates.media-player.html","templates.pause.html","templates.play.html","templates.repeat.html","templates.shuffle.html","templates.skip-next.html","templates.skip-previous.html","templates.volume-mute.html","templates.volume-up.html"]),angular.module("templates.list.html",[]).run(["$templateCache",function(a){"use strict";a.put("templates.list.html",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>')}]),angular.module("templates.media-player.html",[]).run(["$templateCache",function(a){"use strict";a.put("templates.media-player.html",'<div layout="column">\n  \n  <img ng-src="{{album.artworkUrl}}"></img>\n  \n  <md-toolbar class="now-playing-toolbar">\n    \n    <md-progress-linear class="md-accent" md-mode="buffer" value="{{getValue()}}" md-buffer-value="{{getBuffer()}}"></md-progress-linear>\n    \n    <div layout="row" layout-align="space-between center">\n      <div class="md-subhead">{{album.currentTrack().title}}</div>\n      <div class="track-duration">{{audio.currentTime() | playBack}}</div>\n    </div>\n    \n    <div layout="row" layout-align="space-between">\n      <div layout="row">\n        <md-button class="md-icon-button" aria-label="Previous" ng-disabled="!album.hasPreviousTrack()" ng-click="selectPrevious()">\n          <md-icon md-svg-icon="templates.skip-previous.html"></imd-icon>\n        </md-button>\n        <md-button class="md-icon-button" aria-label="{{audio.isPlaying() ? Pause : Play}}" ng-click="audio.isPlaying() ? audio.pause() : audio.play()">\n          <md-icon md-svg-icon="{{audio.isPlaying() ? \'templates.pause.html\' : \'templates.play.html\'}}"></imd-icon>\n        </md-button>\n        <md-button class="md-icon-button" aria-label="Next" ng-disabled="!album.hasNextTrack()" ng-click="selectNext()">\n          <md-icon md-svg-icon="templates.skip-next.html"></imd-icon>\n        </md-button>\n      </div>\n      <div layout="row">\n        <md-button class="md-icon-button" aria-label="Shuffle" ng-click="toggleShuffle()" ng-class="{active: album.isShuffled()}">\n          <md-icon md-svg-icon="templates.shuffle.html"></imd-icon>\n        </md-button>\n        <md-button class="md-icon-button" aria-label="Repeat" ng-click="toggleRepeat()" ng-class="{active: audio.isRepeatEnabled()}">\n          <md-icon md-svg-icon="templates.repeat.html"></imd-icon>\n        </md-button>\n      </div>\n    </div>\n    \n  </md-toolbar>\n  \n</div>\n\n<div layout="column">\n  \n  <md-toolbar>\n    <div class="md-toolbar-tools" layout-align="space-between">\n      \n      <div layout="column">\n        <div class="md-title">{{album.title}}</div>\n        <div class="md-subhead">{{album.artist}} &middot; {{album.release}}</div>\n      </div>\n      \n      <md-button class="md-icon-button" aria-label="Toggle Tracks" ng-click="showTracks = !showTracks">\n        <md-icon md-svg-icon="templates.list.html"></imd-icon>\n      </md-button>\n      \n    </div>\n  </md-toolbar>\n  \n  \n  <md-content layout="column" ng-show="showTracks">\n    <div class="track-list" layout="column">\n      <md-track layout="row" layout-align="start center" ng-repeat="track in album.tracks" ng-click="selectTrack(track, $index)">\n        <div class="track-number">{{track.number | zeroPad}}</div>\n        <div class="track-title">{{track.title}}</div>\n        <md-icon md-svg-icon="{{audio.isPlaying() ? \'templates.volume-up.html\' : \'templates.volume-mute.html\'}}" ng-if="album._current === $index"></md-icon>\n        <div class="track-duration">{{track.duration | playBack}}</div>\n      </md-track>\n    </div>\n  </md-content>\n  \n</div>')}]),angular.module("templates.pause.html",[]).run(["$templateCache",function(a){"use strict";a.put("templates.pause.html",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>')}]),angular.module("templates.play.html",[]).run(["$templateCache",function(a){"use strict";a.put("templates.play.html",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>')}]),angular.module("templates.repeat.html",[]).run(["$templateCache",function(a){"use strict";a.put("templates.repeat.html",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>')}]),angular.module("templates.shuffle.html",[]).run(["$templateCache",function(a){"use strict";a.put("templates.shuffle.html",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>')}]),angular.module("templates.skip-next.html",[]).run(["$templateCache",function(a){"use strict";a.put("templates.skip-next.html",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>')}]),angular.module("templates.skip-previous.html",[]).run(["$templateCache",function(a){"use strict";a.put("templates.skip-previous.html",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>')}]),angular.module("templates.volume-mute.html",[]).run(["$templateCache",function(a){"use strict";a.put("templates.volume-mute.html",'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path d="M5 7v4h3l4 4V3L8 7H5z"/></svg>')}]),angular.module("templates.volume-up.html",[]).run(["$templateCache",function(a){"use strict";a.put("templates.volume-up.html",'<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path d="M12.79 9c0-1.3-.72-2.42-1.79-3v6c1.06-.58 1.79-1.7 1.79-3zM2 7v4h3l4 4V3L5 7H2zm9-5v1.5c2.32.74 4 2.93 4 5.5s-1.68 4.76-4 5.5V16c3.15-.78 5.5-3.6 5.5-7S14.15 2.78 11 2z"/></svg>')}]);